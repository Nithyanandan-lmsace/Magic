{"version":3,"file":"linkexpirytime.min.js","sources":["../src/linkexpirytime.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Magic link expiration form define js.\r\n * @module   auth_magic\r\n * @copyright  2023 bdecent gmbh <https://bdecent.de>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\"core/fragment\",\"core/modal_factory\",\"core/modal_events\",\"core/notification\",\"core/str\", 'core/ajax'],\r\n(function(Fragment,ModalFactory,ModalEvents,notification,String, Ajax) {\r\n\r\n    /**\r\n     * Set Magic login link expiration time setting show in modal.\r\n     * @param {object} params\r\n     */\r\n    function showModal (params) {\r\n        const seletor = document.querySelectorAll(\".magic-loginlink_expiry\");\r\n        seletor.forEach((button) => {\r\n            button.addEventListener('click', function(e) {\r\n                e.preventDefault();\r\n                var userid = e.currentTarget.getAttribute(\"data-id\");\r\n                params.userid = userid;\r\n                ModalFactory.create({\r\n                    type: ModalFactory.types.SAVE_CANCEL,\r\n                    title: String.get_string('linkexpirytime', 'auth_magic'),\r\n                    body: getBodyContent(params),\r\n                    large: true\r\n                })\r\n                .then(function(modal) {\r\n\r\n                    modal.getRoot().on(ModalEvents.save, e => {\r\n                        e.preventDefault();\r\n                        modal.getRoot().find('form').submit();\r\n                    });\r\n\r\n                    modal.getRoot().on('submit', 'form', e => {\r\n                        e.preventDefault();\r\n                        submitFormData(userid);\r\n                        modal.hide();\r\n                    });\r\n\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n                    modal.show();\r\n                    return modal;\r\n                }).catch(notification.exception);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Submit form data.\r\n     * @param {int} userid\r\n     */\r\n    function submitFormData(userid) {\r\n        var modalform = document.querySelectorAll('#linkexpirytime form')[0];\r\n        var formData = new URLSearchParams(new FormData(modalform)).toString();\r\n        Ajax.call([{\r\n            methodname: 'auth_magic_update_link_expiry_time',\r\n            args: {userid: userid, formdata: formData},\r\n            done: function(response) {\r\n                if (response.message) {\r\n                    notification.addNotification({\r\n                        message: response.message,\r\n                        type: \"success\"\r\n                    });\r\n                }\r\n            }\r\n        }]);\r\n    }\r\n\r\n    /**\r\n     * Returns submit form data in load fragment.\r\n     * @param {object} params\r\n     * @returns {Promise}\r\n     */\r\n    function getBodyContent(params) {\r\n        return Fragment.loadFragment('auth_magic', 'link_expiration_form', params.contextid, params);\r\n    }\r\n\r\n    return {\r\n        init: function(params) {\r\n            showModal(params);\r\n        }\r\n    };\r\n}));\r\n\r\n//# sourceMappingURL=linkexpirytime.min.js.map"],"names":["define","Fragment","ModalFactory","ModalEvents","notification","String","Ajax","showModal","params","document","querySelectorAll","forEach","button","addEventListener","e","preventDefault","userid","currentTarget","getAttribute","create","type","types","SAVE_CANCEL","title","get_string","body","getBodyContent","large","then","modal","getRoot","on","save","find","submit","modalform","formData","URLSearchParams","FormData","toString","call","methodname","args","formdata","done","response","message","addNotification","submitFormData","hide","hidden","destroy","show","catch","exception","loadFragment","contextid","init"],"mappings":";;;;;;AAqBAA,mCAAO,CAAC,gBAAgB,qBAAqB,oBAAoB,oBAAoB,WAAY,cAChG,SAASC,SAASC,aAAaC,YAAYC,aAAaC,OAAQC,eAMpDC,UAAWC,QACAC,SAASC,iBAAiB,2BAClCC,SAASC,SACbA,OAAOC,iBAAiB,SAAS,SAASC,GACtCA,EAAEC,qBACEC,OAASF,EAAEG,cAAcC,aAAa,WAC1CV,OAAOQ,OAASA,OAChBd,aAAaiB,OAAO,CAChBC,KAAMlB,aAAamB,MAAMC,YACzBC,MAAOlB,OAAOmB,WAAW,iBAAkB,cAC3CC,KAAMC,eAAelB,QACrBmB,OAAO,IAEVC,MAAK,SAASC,cAEXA,MAAMC,UAAUC,GAAG5B,YAAY6B,MAAMlB,IACjCA,EAAEC,iBACFc,MAAMC,UAAUG,KAAK,QAAQC,YAGjCL,MAAMC,UAAUC,GAAG,SAAU,QAAQjB,IACjCA,EAAEC,0BAmBEC,YAChBmB,UAAY1B,SAASC,iBAAiB,wBAAwB,GAC9D0B,SAAW,IAAIC,gBAAgB,IAAIC,SAASH,YAAYI,WAC5DjC,KAAKkC,KAAK,CAAC,CACPC,WAAY,qCACZC,KAAM,CAAC1B,OAAQA,OAAQ2B,SAAUP,UACjCQ,KAAM,SAASC,UACPA,SAASC,SACT1C,aAAa2C,gBAAgB,CACzBD,QAASD,SAASC,QAClB1B,KAAM,gBA5BN4B,CAAehC,QACfa,MAAMoB,UAGVpB,MAAMC,UAAUC,GAAG5B,YAAY+C,QAAQ,WACnCrB,MAAMsB,aAEVtB,MAAMuB,OACCvB,SACRwB,MAAMjD,aAAakD,0BA+BzB5B,eAAelB,eACbP,SAASsD,aAAa,aAAc,uBAAwB/C,OAAOgD,UAAWhD,cAGlF,CACHiD,KAAM,SAASjD,QACXD,UAAUC"}