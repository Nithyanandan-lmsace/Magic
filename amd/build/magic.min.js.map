{"version":3,"file":"magic.min.js","sources":["../src/magic.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * Pro magic authentication define js.\n * @module   auth_magic\n * @copyright  2022 bdecent gmbh <https://bdecent.de>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery', 'core/fragment', 'core/modal_factory', 'core/modal_events',\n    'core/notification', 'core/str', 'core/templates', 'core/ajax'],\n function($, Fragment, ModalFactory, ModalEvents, notification, Str, Templates, Ajax) {\n\n    var MAGIC;\n\n    /**\n     * Controls Custom styles tool action.\n     * @param {object} params\n     */\n    var Magic = function(params) {\n        var self = this;\n        MAGIC = this;\n\n        if (params.enrolstatus !== undefined) {\n            self.displayAuthInfoBox(params);\n        }\n\n        if (params.cancopylink !== undefined) {\n            self.copyuserLoginlink(params.cancopylink);\n        }\n\n        if (params.hascourseregister) {\n            self.courseQuickRegistration(params);\n        }\n\n        if (params.copycampaignlink !== undefined) {\n            self.copyCampaignLink(params, 'table .action-copy');\n            self.copyCampaignLink(params, 'table .action-couponlink');\n        }\n\n        if (params.campaignformfield !== undefined) {\n            self.vaildateCampaignFormFields();\n            self.changeFormField(params);\n            self.campaignHandler();\n        }\n\n        self.campaignCourse();\n        return true;\n    };\n\n    Magic.prototype.campaignCourse = function() {\n        var self = this;\n        var campaignCourse = document.querySelector(\"#fitem_id_campaigncourse select#id_campaigncourse\");\n        if (campaignCourse) {\n            campaignCourse.addEventListener(\"change\", function(e) {\n                self.setCampaigncourseGroupings(e.target.value, campaignCourse);\n                self.enrolmentKeyFormFieldHandler(e.target.value);\n            });\n            self.setCampaigncourseGroupings(campaignCourse.value, campaignCourse);\n            self.enrolmentKeyFormFieldHandler(campaignCourse.value);\n        }\n\n        var campaignGroup = document.querySelector(\"#fitem_id_campaigngroups select#id_campaigngroups\");\n        if (campaignGroup) {\n            campaignGroup.addEventListener(\"change\", function() {\n                self.setCampaigncourseGroupings(campaignCourse.value, campaignCourse);\n            });\n        }\n    };\n\n    Magic.prototype.enrolmentKeyFormFieldHandler = function(courseid) {\n        if (courseid == '0') {\n            if ($(\"#id_courseenrolmentkey option[value='strict']\").length > 0)  {\n                $(\"#id_courseenrolmentkey option[value='strict']\").remove();\n            }\n        } else {\n            if ($(\"#id_courseenrolmentkey option[value='strict']\").length == 0)  {\n                var strictStr = Str.get_string('campaigns:strict', 'auth_magic');\n                strictStr.done(function(localizedEditString) {\n                    $(\"#id_courseenrolmentkey\").append(\"<option value='strict'>\" +  localizedEditString + \"</option>\");\n                });\n            }\n        }\n    };\n\n    Magic.prototype.setCampaigncourseGroupings = function(courseid) {\n        var self = this;\n        var groupingElement = document.querySelector(\"#fitem_id_campaigngrouping select#id_campaigngrouping\");\n        $(\"#id_campaigncourseheadingcontainer .alert-info\").remove();\n\n        if (courseid == '0') {\n            return false;\n        }\n\n        groupingElement.innerHTML = '';\n        var disabledStr = Str.get_string('disabled', 'auth_magic');\n        disabledStr.done(function(localizedEditString) {\n            self.insertOptionSelectbox('0', localizedEditString, groupingElement);\n        });\n\n\n        Ajax.call([{\n            methodname: 'auth_magic_get_course_groupings',\n            args: {courseid: courseid, campaignid : $('input[name=\"campaignid\"]').attr('value')},\n            done: function(data) {\n                data.groupings.forEach((list) => {\n                    self.insertOptionSelectbox(list.id, list.name, groupingElement);\n                });\n                // Set the selected grouping.\n                if (data.courseinfo.campaign_grouping && $(\"select#id_campaigngrouping option[value=\" +\n                    data.courseinfo.campaign_grouping + \"]\").length) {\n                    groupingElement.value = data.courseinfo.campaign_grouping;\n                }\n\n                // Show separtegroup.\n                var campaignCourseHandler = document.querySelector(\"#fitem_id_campaigncourse\");\n                if (campaignCourseHandler) {\n                    if (!data.courseinfo.is_separtegroup) {\n                        campaignCourseHandler.insertAdjacentHTML(\"afterend\", data.courseinfo.separtegroupinfo);\n                    }\n\n                    if (!data.courseinfo.is_available_selfenrol) {\n                        campaignCourseHandler.insertAdjacentHTML(\"afterend\", data.courseinfo.selfenrolinfo);\n                        self.hideGrouping();\n                    } else {\n                        self.showGrouping();\n                    }\n                }\n            }\n        }]);\n    };\n\n    Magic.prototype.hideGrouping = function() {\n        $(\"#fitem_id_groupcapacity\").hide();\n        $(\"#fitem_id_campaigngrouping\").hide();\n    };\n\n    Magic.prototype.showGrouping = function() {\n        $(\"#fitem_id_groupcapacity\").show();\n        $(\"#fitem_id_campaigngrouping\").show();\n    };\n\n    Magic.prototype.insertOptionSelectbox = function(value, text, element) {\n        var option = document.createElement(\"option\");\n        option.value = value;\n        option.text = text;\n        element.add(option);\n    };\n\n    Magic.prototype.campaignHandler = function() {\n        var self = this;\n        var fieldHandler = document.querySelector(\"#id_securitysectioncontainer #fitem_id_emailconfirm select\");\n        if (fieldHandler) {\n            fieldHandler.addEventListener(\"change\", function(e) {\n                self.campaignSubmissionHandler(e.target.value);\n            });\n            self.campaignSubmissionHandler(fieldHandler.value);\n        }\n    };\n\n    Magic.prototype.campaignSubmissionHandler = function(value) {\n        var submissonHandler = document.querySelector(\"#fitem_id_redirectaftersubmisson select#id_redirectaftersubmisson\");\n        var submissonHandlerOptions = Array.from(submissonHandler.options).map((opt) => opt.value);\n        var addOption = document.createElement(\"option\");\n        addOption.value = \"redirecturl\";\n        var redirecturlStr = Str.get_string('campaigns:redirecturl', 'auth_magic');\n        redirecturlStr.done(function(localizedEditString) {\n            addOption.text = localizedEditString;\n        });\n\n        if (value == '1') {\n            if (submissonHandlerOptions.includes(\"redirecturl\")) {\n                submissonHandler.options.remove(submissonHandler.options.length - 1);\n            }\n        } else {\n            if (!submissonHandlerOptions.includes(\"redirecturl\")) {\n                submissonHandler.options.add(addOption);\n            }\n        }\n    };\n\n    Magic.prototype.changeFormField = function(params) {\n        var self = this;\n        var fieldHandler = document.querySelector(\"#id_formfieldsection #fitem_id_linkfields select\");\n        if (fieldHandler) {\n            fieldHandler.addEventListener(\"change\", function(e) {\n                params.relateduser = e.target.value;\n                params.currentcampaignid = $('input[name=\"campaignid\"]').attr('value');\n                self.getUserFormField(params);\n            });\n        }\n    };\n\n    Magic.prototype.getUserFormField = function(params) {\n        var self = this;\n        var fragment =  Fragment.loadFragment('auth_magic', 'get_user_formfield', params.contextid, params);\n        document.querySelectorAll(\"body\")[0].classList.add(\"load-icon\");\n        fragment.done(function(html, js) {\n            // Remove the mform based unique id.\n            var currentMformID = $(\"#page-auth-magic-campaigns-edit .mform\").attr(\"id\");\n            js = js.replace(/mform1_[A-Za-z0-9]+/g, currentMformID);\n            var tempElement = document.createElement('div');\n            tempElement.innerHTML = html;\n\n            // Remove the collaspse section js.\n            var collapseSectionsId = $(\"#\" + currentMformID + \" .collapsible-actions a\").attr(\"id\");\n            if (collapseSectionsId) {\n                js = js.replace(/#collapsesections[A-Za-z0-9]+/g, \"#\" + collapseSectionsId);\n            }\n\n            // Remove the filemanager js.\n            var formfields = tempElement.querySelector('#id_formfieldsection');\n            $(\"#page-auth-magic-campaigns-edit .mform #id_formfieldsection\").replaceWith(formfields);\n            // Implement the show expand formfield section .\n            $(\"#id_formfieldsection a[data-toggle='collapse']\").attr(\"aria-expanded\", \"true\");\n            $(\"#id_formfieldsection a[data-toggle='collapse']\").removeClass(\"collapsed\");\n            $(\"#id_formfieldsection #id_formfieldsectioncontainer\").addClass(\"show\");\n            Templates.runTemplateJS(js);\n            $(\"#id_formfieldsection select#id_linkfields\").val(params.relateduser);\n            document.querySelectorAll(\"body\")[0].classList.remove(\"load-icon\");\n        }.bind(self)).fail(notification.exception);\n    };\n\n    Magic.prototype.vaildateCampaignFormFields = function() {\n        var self = this;\n        var otherFiedlsHandler = document.querySelectorAll(\"#id_formfieldsection .campaign_otherform_fields select\");\n        if (otherFiedlsHandler) {\n            otherFiedlsHandler.forEach((item) => {\n                // When change the field handler element remove the others boxes.\n                item.addEventListener(\"change\", function(e) {\n                    self.rearrangeFormFields(e.target);\n                });\n                self.disableEmptyField(item);\n                self.rearrangeFormFields(item);\n            });\n        }\n    };\n\n    Magic.prototype.disableEmptyField = function(currentElement) {\n        if (currentElement.options.length == 0) {\n            setTimeout(function() {\n                var option = document.createElement(\"option\");\n                option.value = \"none\";\n                var none = Str.get_string('none', 'auth_magic');\n                none.done(function(localizedEditString) {\n                    option.text = localizedEditString;\n                });\n                option.selected = true;\n                currentElement.options.add(option);\n                currentElement.disabled = true;\n            }, 500);\n            var currentField = currentElement.getAttribute('data-field'); // Last name\n            var currentFieldOption = document.querySelector(\"select[name='\" + currentField + \"_option']\");\n            var optionLabels = Array.from(currentFieldOption.options).map((opt) => opt.value);\n            if (optionLabels.includes(\"50\")) {\n                currentFieldOption.options.remove(currentFieldOption.options.length - 1);\n            }\n        }\n    };\n\n    Magic.prototype.rearrangeFormFields = function(currentElement) {\n        var self = this;\n        var currentSelectval = currentElement.value;\n        if (currentSelectval) {\n            var currentField = currentElement.getAttribute('data-field'); // Get current form field.\n            // Get form field select element.\n            var changeSelectField = document.querySelector(\"#id_formfieldsection .campaign_otherform_fields #id_\"\n                + currentSelectval + \"_otherfield\");\n            if (changeSelectField) {\n                // Get form field all options.\n                var changeSelectFieldValues = self.getFieldDefaultValues(currentSelectval);\n                var changeSelectFieldDefault = changeSelectField.value;\n                // Remove the form field all options.\n                for (var i = changeSelectField.options.length; i >= 0; i--) {\n                    changeSelectField.options.remove(i);\n                }\n                // Add the form field options (Removing the related one).\n                // (one or more same element selected to the field, that field remove the them. )\n                // Example (lastname & city field select to \"username option\")\n                // then (Username field remove the lastname & city both options).\n                for(var j = 0; j < changeSelectFieldValues.length; j++) {\n                    let optionfield = document.querySelector(\"select[name='\" +\n                        Object.keys(changeSelectFieldValues[j]) + \"_otherfield']\");\n                    if (optionfield != undefined && optionfield.value != currentSelectval) {\n                        var option = document.createElement(\"option\");\n                        option.value = Object.keys(changeSelectFieldValues[j]);\n                        option.text = Object.values(changeSelectFieldValues[j]);\n                        if (changeSelectFieldDefault == option.value) {\n                            option.selected = true;\n                        }\n                        changeSelectField.options.add(option);\n                    }\n                }\n            }\n\n\n            // Below set of codes to the insert the option. When modifiy to select.\n            // Example (above (lastname & city field select to \"username option\"))\n            // User changed to the  lastname field to other one.\n            // Result: \"Username\" field add the lastname option.\n\n            // Add the provious select value.\n            var currentFieldPreValue = document.querySelector(\"input[name='\" + currentField + \"_otherfield_prevalue']\");\n            // Check provious value exit add the value.\n            if (currentFieldPreValue != undefined && currentFieldPreValue.value != \"\") {\n                var fieldPreValues = self.getFieldDefaultValues(currentFieldPreValue.value);\n                var index = fieldPreValues.findIndex(function(obj) {\n                    return obj.hasOwnProperty(currentField);\n                });\n                if (index) {\n                    var changePreSelectField = document.querySelector(\"#id_formfieldsection .campaign_otherform_fields #id_\" +\n                        currentFieldPreValue.value + \"_otherfield\");\n                    if (changePreSelectField) {\n                        var option = document.createElement(\"option\");\n                        option.value = Object.keys(fieldPreValues[index]);\n                        option.text = Object.values(fieldPreValues[index]);\n                        changePreSelectField.insertBefore(option, changePreSelectField.options[index]);\n                    }\n                }\n            }\n\n            if (currentFieldPreValue) {\n                currentFieldPreValue.value = currentSelectval;\n            }\n\n        }\n    };\n\n    Magic.prototype.getFieldDefaultValues = function(currentSelectval) {\n        var changeSelectFieldValues = [];\n        var changeSelectFieldOptions = document.querySelectorAll(\"input[name='\" + currentSelectval + \"_otherfield_value[]']\");\n        changeSelectFieldOptions.forEach(function(inputElement) {\n            var val = {};\n            val[inputElement.value] = inputElement.getAttribute('data-value');\n            changeSelectFieldValues.push(val);\n        });\n        return changeSelectFieldValues;\n    };\n\n    Magic.prototype.courseQuickRegistration = function(params) {\n        var uniqueid = \"user-index-participants-\" + params.courseid;\n        var handleSelector = \".pagelayout-incourse [data-table-uniqueid=\" + uniqueid + \"]\";\n        var addHandler = document.querySelectorAll(handleSelector);\n        if (addHandler) {\n            var singleButton = document.createElement(\"div\");\n            singleButton.setAttribute(\"class\", \"singlebutton quickregister-button\");\n\n            // Create a form.\n            var form = document.createElement(\"form\");\n            form.setAttribute(\"method\", \"get\");\n            form.setAttribute(\"action\", params.url);\n            form.setAttribute(\"id\", \"quickregister-button\");\n\n            // Create an input element for Full Name\n            var courseblock = document.createElement(\"input\");\n            courseblock.setAttribute(\"type\", \"hidden\");\n            courseblock.setAttribute(\"name\", \"courseid\");\n            courseblock.setAttribute(\"value\", params.courseid);\n\n            var submit = document.createElement(\"input\");\n            submit.setAttribute(\"type\", \"submit\");\n            submit.setAttribute(\"value\", params.strquickregister);\n            submit.setAttribute(\"class\", \"btn btn-secondary my-1\");\n\n            form.appendChild(courseblock);\n            form.appendChild(submit);\n            singleButton.appendChild(form);\n            addHandler[0].appendChild(singleButton);\n        }\n    };\n\n    Magic.prototype.copyuserLoginlink = function(cancopylink) {\n        var self = this;\n        if (cancopylink) {\n            var invitationlink = document.querySelectorAll(\"table.magicinvitationlink .magic-invitationlink\");\n            if (invitationlink) {\n                invitationlink.forEach(function(items) {\n                    items.addEventListener('click', function(e) {\n                        e.preventDefault();\n                        var userlogin = e.currentTarget.getAttribute(\"data-invitationlink\");\n                        self.copyText(userlogin);\n                    });\n                });\n            }\n        }\n    };\n\n    Magic.prototype.copyTextCliboard = function() {\n        var self = this;\n        var copyTextBlock = document.querySelectorAll(\".auth-magic-block #copy-text\")[0];\n        if (copyTextBlock) {\n            self.copyText(copyTextBlock.value, true);\n            copyTextBlock.select();\n        }\n    };\n\n    Magic.prototype.copyText = function(copytext, modal = false) {\n        if (typeof (navigator.clipboard) == 'undefined') {\n            var textArea = document.createElement(\"textarea\");\n            textArea.value = copytext;\n            // Avoid scrolling to bottom\n            textArea.style.top = \"0\";\n            textArea.style.left = \"0\";\n            textArea.style.position = \"fixed\";\n            if (!modal) {\n                document.body.appendChild(textArea);\n            } else {\n                document.querySelectorAll(\".modal .modal-content\")[0].appendChild(textArea);\n            }\n            textArea.focus();\n            textArea.select();\n            try {\n                document.execCommand('copy');\n            } catch (err) {\n                return false;\n            }\n            if (!modal) {\n                document.body.removeChild(textArea);\n            } else {\n                document.querySelectorAll(\".modal .modal-content\")[0].removeChild(textArea);\n            }\n        } else {\n            navigator.clipboard.writeText(copytext);\n        }\n        return true;\n    };\n\n    Magic.prototype.copyCampaignLink = function(params, element) {\n        var copyCampaign = document.querySelectorAll(element);\n        copyCampaign.forEach((campaign) => {\n            campaign.addEventListener('click', (e) => {\n                e.preventDefault();\n\n                var target = e.currentTarget;\n                var link = target.dataset.campaignlink;\n                params.campaignlink = link;\n                params.campaign = true;\n\n                ModalFactory.create({\n                    title: params.campaigntitle,\n                    type: ModalFactory.types.CANCEL,\n                    body: Templates.render('auth_magic/modalbox', params),\n                    large: true\n                }).then(function(modal) {\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.bodyRendered, function() {\n                        var copyBoardButton = document.querySelectorAll(\".auth-magic-block .copy-link-block #copy-cliboard\")[0];\n                        if (copyBoardButton) {\n                            copyBoardButton.addEventListener(\"click\", () => {\n                                MAGIC.copyText(link);\n                                var copyBoardElement = document.querySelectorAll(\".auth-magic-block #copy-campaign-link\")[0];\n                                if (copyBoardElement) {\n                                    copyBoardElement.select();\n                                }\n                            });\n                        }\n                    });\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    return modal;\n                }).catch(notification.exception);\n\n            });\n        });\n    };\n\n    Magic.prototype.getAuthMagicBody = function(params) {\n        return Fragment.loadFragment('auth_magic', 'display_box_content', params.contextid, params);\n    };\n\n    Magic.prototype.getAuthMagicCampaignBody = function(params) {\n        return Fragment.loadFragment('auth_magic', 'get_campaign_body', params.contextid, params);\n    };\n\n\n    Magic.prototype.displayAuthInfoBox = function(params) {\n        var self = this;\n        ModalFactory.create({\n            title: params.strconfirm,\n            type: ModalFactory.types.CANCEL,\n            body: self.getAuthMagicBody(params),\n            large: true\n        }).then(function(modal) {\n            modal.show();\n            modal.getRoot().on(ModalEvents.bodyRendered, function() {\n                var copyBoardButton = document.querySelectorAll(\".auth-magic-block .copy-link-block #copy-cliboard\")[0];\n                if (copyBoardButton) {\n                    copyBoardButton.addEventListener(\"click\", self.copyTextCliboard.bind(self));\n                }\n            });\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n                window.open(params.returnurl, '_self');\n            });\n            return modal;\n        }).catch(notification.exception);\n    };\n\n    Magic.prototype.getAuthMagicBody = function(params) {\n        return Fragment.loadFragment('auth_magic', 'display_box_content', params.contextid, params);\n    };\n\n    return {\n        init: function(params) {\n            return new Magic(params);\n        }\n    };\n\n });\n"],"names":["define","$","Fragment","ModalFactory","ModalEvents","notification","Str","Templates","Ajax","MAGIC","Magic","params","this","undefined","enrolstatus","displayAuthInfoBox","cancopylink","copyuserLoginlink","hascourseregister","courseQuickRegistration","copycampaignlink","copyCampaignLink","campaignformfield","vaildateCampaignFormFields","changeFormField","campaignHandler","campaignCourse","prototype","self","document","querySelector","addEventListener","e","setCampaigncourseGroupings","target","value","enrolmentKeyFormFieldHandler","campaignGroup","courseid","length","remove","get_string","done","localizedEditString","append","groupingElement","innerHTML","insertOptionSelectbox","call","methodname","args","campaignid","attr","data","groupings","forEach","list","id","name","courseinfo","campaign_grouping","campaignCourseHandler","is_separtegroup","insertAdjacentHTML","separtegroupinfo","is_available_selfenrol","showGrouping","selfenrolinfo","hideGrouping","hide","show","text","element","option","createElement","add","fieldHandler","campaignSubmissionHandler","submissonHandler","submissonHandlerOptions","Array","from","options","map","opt","addOption","includes","relateduser","currentcampaignid","getUserFormField","fragment","loadFragment","contextid","querySelectorAll","classList","html","js","currentMformID","replace","tempElement","collapseSectionsId","formfields","replaceWith","removeClass","addClass","runTemplateJS","val","bind","fail","exception","otherFiedlsHandler","item","rearrangeFormFields","disableEmptyField","currentElement","setTimeout","selected","disabled","currentField","getAttribute","currentFieldOption","currentSelectval","changeSelectField","changeSelectFieldValues","getFieldDefaultValues","changeSelectFieldDefault","i","j","optionfield","Object","keys","values","currentFieldPreValue","fieldPreValues","index","findIndex","obj","hasOwnProperty","changePreSelectField","insertBefore","inputElement","push","handleSelector","addHandler","singleButton","setAttribute","form","url","courseblock","submit","strquickregister","appendChild","invitationlink","items","preventDefault","userlogin","currentTarget","copyText","copyTextCliboard","copyTextBlock","select","copytext","modal","navigator","clipboard","textArea","style","top","left","position","body","focus","execCommand","err","removeChild","writeText","campaign","link","dataset","campaignlink","create","title","campaigntitle","type","types","CANCEL","render","large","then","getRoot","on","bodyRendered","copyBoardButton","copyBoardElement","hidden","destroy","catch","getAuthMagicBody","getAuthMagicCampaignBody","strconfirm","window","open","returnurl","init"],"mappings":"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"}